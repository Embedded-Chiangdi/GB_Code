#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>    
#include <sys/stat.h>    
#include <fcntl.h>
#include <sys/ioctl.h>

#define TESTDEV "/dev/writebuf"
#define TYPE_KEY 'w'
#define COMMAND_WF1 _IOWR(TYPE_KEY,1,unsigned long)
#define COMMAND_WF2 _IOWR(TYPE_KEY,2,unsigned long)
#define COMMAND_WF3 _IOWR(TYPE_KEY,3,unsigned long)

unsigned char buf_t[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF0,0xE0,0xC0,0x80,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x40,0x20,0x10,0x90,0x90,0x90,0x90,0x10,0x20,0x40,0x00,0x00,0x00,0x00,0x00,
0x00,0xF0,0x10,0x10,0x10,0xD0,0x10,0x10,0x10,0x10,0xF0,0x00,0x00,0x00,0x00,0x00,
0x00,0xF8,0x28,0x68,0xB8,0x00,0x00,0x00,0xC0,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,
0x00,0x48,0x30,0x30,0x48,0x00,0x00,0x00,0xC0,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,
0x00,0xF0,0x10,0xD0,0xD0,0xD0,0xD0,0xD0,0x10,0xF0,0xC0,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x0F,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x00,0x0C,0x0C,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x0F,0x08,0x08,0x08,0x0A,0x08,0x08,0x04,0x04,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x18,0x00,0x1C,0x00,0x1F,0x00,0x1F,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x18,0x00,0x1C,0x00,0x1F,0x00,0x1F,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,
0x00,0x0F,0x08,0x0B,0x0B,0x0B,0x0B,0x0B,0x08,0x0F,0x03,0x00,0x00,0x00,0x00,0x00,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x04,0x80,0x20,0x00,0x00,
0x82,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x05,0x81,0x01,0x01,0x01,0x00,
0x00,0x08,0x00,0x00,0x00,0x0A,0x08,0x08,0x91,0x20,0x00,0x7C,0x00,0x01,0x00,0xEE,
0x00,0x00,0x9E,0x00,0x08,0x00,0x70,0x00,0x38,0x82,0x01,0x01,0x82,0x00,0x00,0xFE,
0x03,0x08,0x40,0x80,0x20,0x04,0x03,0x00,0x00,0x82,0x10,0x00,0x00,0x00,0x00,0xFF,
0x00,0x00,0x80,0x40,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x02,0x01,
0x00,0x00,0x01,0x00,0x00,0x02,0x20,0xA0,0xA0,0xA0,0xA0,0xA1,0xA0,0xA0,0x21,0x00,
0x00,0x00,0x00,0x00,0x00,0x40,0x21,0x21,0x40,0x00,0x00,0x80,0x00,0x21,0x01,0xC0,
0x00,0x00,0xE0,0x41,0x01,0x00,0x00,0x00,0x40,0xE0,0x01,0x01,0xE0,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x00,0x20,0x10,0x04,0x40,0x20,
0x10,0x00,0x20,0x40,0x00,0x40,0x40,0x1E,0x22,0x02,0x02,0x42,0x42,0x5C,0x40,0x00,
0x00,0x00,0x00,0x00,0x20,0x28,0x20,0x24,0x23,0x00,0x00,0x1F,0x20,0x20,0x20,0x1D,
0x00,0x00,0x3F,0x00,0x06,0x10,0x10,0x02,0x00,0x3F,0x00,0x00,0x3F,0x02,0x02,0x02,
0x02,0x02,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,
0x40,0x00,0x80,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
0x00,0x00,0x0A,0x10,0x11,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x77,
};

int main(int argc, char **argv){
    
    int fd;
    int ret = 0;
    int this_bytes_tx = 0;
    printf("This is a Test APP\n");


    fd = open(TESTDEV,O_WRONLY);
    if(fd < 0){
        ret = -1;
        printf("failed open %d",fd);
        goto err;
    }

    this_bytes_tx = write(fd,buf_t,sizeof(buf_t));
    
    ret = this_bytes_tx;

    if(!this_bytes_tx){
        printf("failed write %d",this_bytes_tx);
        goto err;
    }
    
    printf("Write %d bytes\n",this_bytes_tx);
    

    /*ioctl test*/

    ret = ioctl(fd,COMMAND_WF1,100);
    if(ret < 0)
        goto err;
    ret = ioctl(fd,COMMAND_WF2);
    if(ret < 0)
        goto err;

    ret = ioctl(fd,COMMAND_WF3,1);
    if(ret < 0)
        goto err;
    
    printf("Send ioctls success \n");

    close(fd);

err:
    return ret;
}